# 更新记录

## v1.0.35 (2026-02-21)
- **新功能：防强杀与电池优化白名单保护**
  - **白名单检测引擎**：在“设置”页新增了“系统权限 - 后台播放保护”模块，自动诊断当前设备是否将离线听书拉入了能切断后台播音的休眠“黑名单”中。
  - **系统级权限接驳**：如果您的设备经常在息屏时自动“杀后台”导致听书中断，点击“去设置”按钮将安全地直接调起 Android 原生的保护豁免弹框。一旦您主动授予“忽略电池优化”，就可以安心享受彻夜播放而绝对不断联！

## v1.0.34 (2026-02-21)
- **新功能：音量自动均衡 (Volume Normalization) **
  - **动态处理框架**：底层接入了 Android 9.0 以上设备专属的动态音频后处理模块 `DynamicsProcessing`。
  - **人声防爆音与提振**：针对不同集音频“声音忽大忽小”甚至破音刺耳的痛点，该技术能智能识别低于正常阈值（-30dB）的微弱声音进行**向上增益与提拉压缩**（提供 +15dB 的补偿），并且为总输出通道上了一把“防爆音安全锁”（Limiter 限制器阈值 -2dBFS），保证不论原来声音有多小、音效有多炸，输出的响度都始终保持在最舒适、稳定的范围内！
  - **独立操作区**：整合至播放器全新设计的两排 6 格扩展控制台上。

## v1.0.33 (2026-02-21)
- **新功能：人声增强**
  - **动态均衡器**：新接入了 Android 原生硬件级别的 `Equalizer`。针对主播讲书时声音被吵杂背景音或音效盖过的痛点，我们在底层专门为 300Hz-4000Hz 之间的人声黄金频率设置了智能高保真增益。
  - **独立交互面板**：在播放器界面的下方的增强动作面板中（原4格栅扩充为5格栅），新增了“人声增强”开关组件。您可以一键压制不必要的背景重低音，瞬间拥有广播剧级的清晰主播原生听感！

## v1.0.32 (2026-02-21)
- **新功能：支持语音助手直接唤醒与播放**
  - **深度集成**：底层新增了对 `android.media.action.MEDIA_PLAY_FROM_SEARCH` 意图的支持。现在您可以在 ColorOS (小布) 等系统的语音助手界面直接下达“播放离线听书”等指令，APP 将会被瞬间拉起执行。
  - **沉浸衔接**：通过构建原生层向前端的专属通信桥（`voicePlayCommand`），在由语音助手冷启动或热唤醒时，应用会自动定位到您最新收听的一本书籍并自动开始播放，无需任何额外手动点击。

## v1.0.31 (2026-02-21)
- **修复：解决后台长时间锁屏后“睡死”和音频焦点重置问题**
  - **核心底层升级**：重新配置了 Android 原生的 ExoPlayer 引擎。开启了更严格的网络休眠锁（`setWakeMode(C.WAKE_MODE_NETWORK)`），并注入了系统级音频焦点管理（`setAudioAttributes(..., true)`）。从根本上解决了当其他应用抢占音频焦点时 MediaSession 崩溃突变的问题。
  - **后台挂起保护**：全局排查了前端至底层的逻辑，确保在系统因省电策略发起打断信号时，应用只会安全地触发 `pause()`，严禁在此过程中主动调用 `stop()` 或 `release()`，从而避免触发安卓系统更严厉的后台查杀。现在不论锁屏多久，媒体控件也将稳定长存！

## v1.0.30 (2026-02-20)
- **优化：收听报告全屏显示**
  - 移出了收听报告页面的宽度限制，现在页面会根据屏幕尺寸自适应全屏显示，在大屏手机上效果更佳。

## v1.0.29 (2026-02-20)
- **修复：分享报告生成报错**
  - 解决了 html2canvas 无法解析现代 CSS `oklch` 颜色导致截图失败的问题。通过将主题颜色回退到传统的 Hex 格式，确保了分享图片的生成稳定性。

## v1.0.28 (2026-02-20)
- **修复：分享图片生成及权限问题**
  - 在 Android 14+ 设备上增加了必要的存储和媒体访问权限。
  - 优化了分享图片保存逻辑：优先使用系统原生分享，若失败则保存至系统“文档”文件夹。
  - 改进了截屏稳定性，增加了渲染缓冲区间。

## v1.0.27 (2026-02-20)
- **新功能：恢复未播放状态**
  - 在书库的书籍菜单中增加“恢复未播放”选项。
  - 对于已产生播放进度的书籍，点击此选项可一键清空该书的所有播放进度，将其重置为“未播放”状态，方便重新收听。

## v1.0.26 (2026-02-20)
- **修复：跨书连播信息同步问题**
  - 解决了在播放界面自动切书后，书籍标题和封面图未及时更新的问题。现在播放界面会实时跟随播放器的书籍状态同步更新路由。
- **优化：内部状态监听机制**
  - 提升了播放状态与 UI 渲染的一致性。

## v1.0.25 (2026-02-20)
- **新功能：跨书自动连播**
  - **系列连播**: 实现了书友们期待已久的功能！当一本书播放到最后一章结束后，APP 会根据书名智能寻找同系列的“下一部”并自动开始播放（例如：第一季播完自动开播第二季）。
  - **智能识别**: 结合 v1.0.24 的自然排序逻辑，精准定位系列顺序，告别手动切书的繁琐。
  - **逻辑优化**: 只有在识别到书籍前缀一致时才会触发连播，确保不会意外跳到无关的书籍。

## v1.0.24 (2026-02-20)
- **优化：书籍智能自然排序**
  - **中文数字识别排序**: 书库按书名排序时，现在能够正确识别中文数字序号（如"第一季""第二季"...直至"第九十九季"），自动转换为阿拉伯数字后进行自然排序。例如"盗墓笔记_第一季" → "盗墓笔记_第二季" → "盗墓笔记_第十季"将严格按照季数顺序排列，而非字符的字典序。
  - **支持多种量词**: 支持"季/部/卷/章/集/册/回/篇"等常用量词后缀的中文数字排序。
  - **混合数字兼容**: 同时支持阿拉伯数字（如 1, 2, 10）和中文数字的混合排序场景。

## v1.0.23 (2026-02-20)
- **改进与优化：分享功能升级与视觉修复**
  - **沉浸式成就图分享**: 将原本的文本分享升级为了真实的“图片截屏分享”。当您点击“分享我的成就”时，APP 会自动将这极具现代感的数据报告生成为一张高清图片并调用原生菜单分享，让您的朋友也能直观看到您的听书成就！
  - **排版修正**: 修复了收听报告界面上“累计收听时长”数字模块的未对齐异常问题，确保数字与单位以最优的堆叠版式呈现。
  - **视觉纯化**: 移除了界面底部的多余商标信息，让数据图本身更加专注和干净。

## v1.0.22 (2026-02-20)
- **新功能：精美的数据分享页**
  - **成就总览**: 全新重构了应用内的分享页面（点击收听报表右上角进入）。在设计上采用了极具现代感的流体渐变背景、带有阴影纵深的悬浮卡片设计，能让您沉浸式查阅自己的收听成就。
  - **动态数据统计**: 新页面会自动统计您本月内的各种硬核数据：如累计收听时长、日均听书时间、连续活跃天数、以及阅读完的书籍数量计算。并会利用封面卡片特殊展示您本月的“最常听书籍”。
  - **一键分享口号**: 底部新增醒目的渐变分享按钮，您可以直接通过原生系统一键分享专属于您的成就播报文本（如“本月我已听书 12 小时 45 分钟，连续活跃 X 天！”）至微信等社交媒体。
  - **视觉优化**: 注入了专属的 Audiostat Premium 徽标元素，增强高级质感。
## v1.0.21 (2026-02-20)
- **Bug 修复：收听报表滚动问题**
  - **问题修复**: 修复了“收听报表”页面打开时，由于页面内的滚动容器并非全局 window 导致无法默认置于顶部的问题。现已支持正确定位到内部 `scroll-container` 的顶部，保证每次打开都是从头开始展示。
  - **应用更新**: 迭代内部所有配置文件版本号到 v1.0.21。

## v1.0.20 (2026-02-20)
- **Bug 紧急修复：播放进度自动归零**
  - **严重故障修复**: 极速为您修复了 `v1.0.19` 为了消除进度闪烁而引发的罕见底层冲突恶性 Bug。
  - **故障原因**: 此前版本由于提前锁定了播放状态，导致原生 ExoPlayer 服务在后台首次载入您的实体书时，其抛出的底层“已准备就绪/内部章节首发切换”事件骗过了正在等待的前端，触发了误触安全机制，强制推平了您的记忆时间（也就是归零）。
  - **解决方案**: 我在 JavaScript 桥接层部署了一个“事件原路核对哨兵”，现已完美屏蔽底层的干扰初始信号，您的进度彻底安全了！
- **Bug 修复：播放进度闪烁与图表交互**
  - **播放闪烁修复**: 解决了从其他页面点击“继续收听”跳转到播放器时，进度条会短暂显示 `00:00` 然后才跳动到真实进度的问题。通过改变状态同步顺序，目前在启动底层播放引擎之前，React 界面就已经锁定真实的记忆时间。
  - **报表页滚动修复**: 修复了从其他地方跳转进入“收听报表”时，页面不会自动置顶的问题。
  - **图表滑动交互**: 升级了收听报表里的趋势折线图交互！以往查阅详细数据必须精准点击节点（小圆点），现在支持直接在图表区域内左右滑动手指（类似股票软件），数据气泡会丝滑跟随手指游走！
- **体验补全：锁屏与系统媒体控制条的封面同步**
  - **修复**: 彻底解决了当您智能刮削了高清实体书封面后，系统下拉通知栏以及锁屏界面的媒体播放器依然显示灰色默认音乐图标的问题。
  - **技术升级**: 现在 Capacitor 的 TS 核心会将巨型的 Base64 高清图片数据安全地反向传输渗透给原生的 Java Android Media3 (ExoPlayer) 引擎。由底层媒体服务解析并渲染为 `MediaMetadata.PICTURE_TYPE_FRONT_COVER`，完美融入安卓生态的锁屏环境！
- **回滚与撤销功能**：
  - 移除了在 `v1.0.16` 引入的“设置页面弹簧回弹互动（Rubber Band Scroll Bounce）”功能。
  - **原因**：部分设备在持续滑动手势下，由于物理参数计算差异依然会感受到轻微卡顿或非原生般的阻滞感。应用户反馈，现已将其完整切除，恢复到最原始流畅的原生系统惯性滚动状态。
  - **恢复**：同时恢复了设置页面底部的安全留白（Padding），以确保在各种全面屏或带底部导航槽的手机上均能舒适触底阅读。
- **体验优化：iOS/微信级回弹滑动（Rubber Band）**
  - **问题修复**: 移除了“设置栏”底部不必要的过高留白 padding，解决了此前因高度溢出导致页面可以无限干滑却什么内容也没有的问题。
  - **物理引擎级交互重构**: 我们听取了您的建议，在设置页面单独引入了贴近原生（微信/iOS同款）的 `Pull-to-bounce` 橡皮筋手势物理引擎算法。现在：
    - 当页面处于顶部或底部，甚至只有一页不需要滚动时，您继续上下拖拽，页面会顺畅地被拉出一段距离（阻尼随拉扯距离动态增加，拉得越远拉力越大）。
    - 当手指松开的瞬间，页面会伴随优雅的贝塞尔曲线（cubic-bezier）自然轻巧地弹回原位，交互体验直接拉满！
- **体验优化：全局导入队列重构**
  - **问题修复**: 彻底解决了之前选中多个文件夹导入时，全局进度条和状态疯狂闪烁、互相重叠、甚至“假死”提前消失的现象。
  - **最新逻辑**: 现在将所有选中的书籍和文件列装进一个巨大的**统一批处理队列**（Batch Processing）。进度条会在所有书籍和所有文件全部扫描完毕之后统一计算100%分母。
  - **进度显示**: 全局悬浮气泡现在会清晰地显示 `当前进度: 已处理文件数/总计文件数`，让你对超大批量导入的时间预估有了最踏实的底气。
  - **完成驻留**: 在队列里的最后一张专辑拷贝完毕前，悬浮进度条绝不会消失。
- **UI 精雕细琢**
  - **精简“书库”筛选维度**: 修复了之前“正在听”和“有进度”逻辑重叠的冗余设计，现重构分类为：`全部`、`正在听`（有进度记录）、`未播放`（完全没有进度记录的吃灰书）。
  - **统一“设置”页面布局风**: 响应大家呼声，去除了设置页面顶部占面积巨大且略显突兀的居中大图标，将“设置”文本规范地与其他页面一样贴齐左上角，让界面更加沉浸和简约。

## v1.0.14 (2026-02-20)
- **体验补全**: 首页视觉全面适配！主页上极具视觉冲击力的“当前正在收听”大型动态卡片，以及“最近添加”滑块现在都已完美支持并直接呈现您刮削到的高清封面图。

## v1.0.13 (2026-02-20)
- **新功能**: 隆重推出**“全智能连网封面刮削”**功能！
    - **原理背景**: 《懒人听书》搜集了极为庞大完善的中文有声书面数据资源，我们希望可以站在巨人的肩膀上来提供优质的封面展现，又必须在深山老林里依然能高糊显示（离线可用）。
    - **解决方式**: 在“书籍编辑”页面新增了“智能刮削封面”按钮。我们利用底层 Capacitor HTTP 技术伪装合法请求，跳出了 Web CORS 的束缚，直捣懒人听书的搜索 API。
    - **使用体验**: 您只需在编辑书名后点击按钮，便会弹出一个沉浸式的图片流界面供您挑选最合适的封面。一旦您点击中意的封面，系统会暗自用 C++ 底座瞬间通过网络流将高清图剥离为 100% 纯净的 Base64 编码，并直接存储压缩到本地 IndexedDB 中。以后再无网络也能一秒展现。
    - **多处界面适配**: 书库主页、剧集详细列表，以及巨大圆角的播放器主视觉版面现在都会完美兼容并华丽地呈现您刚刚抓取回来的实体封面图了！
    - **用户反馈修正**: 关于上个版本（1.0.12）用户反馈的后台进度条“假死/重置”情况，会在接下来的补丁中将“多个文件夹单任务化”重构成“多任务并总控”结构，当前以实现核心刮削功能优先。
- **新功能**: 重构了音频文件导入机制，实现了真正的**“后台静默导入”**与**“全局进度监测”**！
    - **原理背景**: 原先导入大量文件时（尤其是整个文件夹数百集有声书），界面会强制要求用户停留在“导入”页面干等，一旦手滑返回，可能会丢失进度反馈甚至中断后续的索引创建流程。
    - **解决方式**: 现在所有的原生文件流拷贝与数据库解析指令都已经下沉到了系统的全局层（App Context）。
    - **体验升级**: 您在选择完成需要导入的文件/文件夹后，界面会**自动瞬间弹回书库**供您继续浏览或听书，同时屏幕最下方升起一个精美小巧的悬浮进度提示条（Global Toast），不仅能实时跟踪当前正处理的文件名，还带有全局进度百分比，做到完全无阻塞的并行听书和导书！

## v1.0.11 (2026-02-20)
- **重大修复**: 彻底修复了书库多选删除界面的确认弹窗会被底部内容或者顶层状态栏遮挡、且跟书单“同屏共舞”一起滚动的问题。
    - **原因**: 现代浏览器的 CSS `transform` 或 `filter: blur` 效果会重置局地元素的叠加上下文（Stacking Context）。所以之前即便我们给了模态框再大的 `z-index`，它也逃脱不出那个含有过渡动画的上层父容器。
    - **解决**: 使用了 React 核心渲染技术中的 **`createPortal`（传送门引擎）**，将该弹窗的所有 DOM 节点直接强制“越狱”注入到最外层 `document.body` 中，完美打破一切组件层级枷锁。现在它真正成为了覆盖在系统全局视窗之上的绝对第一层（真·最上层），再也不会被切割或卷动了。

## v1.0.10 (2026-02-20)
- **优化**: 移除了搜索页“热门推荐”板块在获取数据时的 loading 动画圈圈。现在如果是处于离线没网状态，系统会直接保持界面的清爽，静默隐藏该板块并且仅显示原先的“输入关键词搜索书库”提示；只有当成功拉取到推荐数据后才会华丽呈现瀑布流榜单。
- **修复**: 更新了“设置 - 关于本机”以及页面最底部的硬编码版本号文本，使其与内部真实的 `1.0.10` 一致。

## v1.0.9 (2026-02-20)
- **修复**: 修复了 v1.0.7 中“热门推荐”板块未成功实装且拉取数据失败的问题。
    - **原因 1**: 上个版本中 Search.tsx 存在一个未闭合的 JSX 标签语法错误，导致底层 Vite 编译直接崩溃停止，但打包脚本依然强行把旧版本 JS 塞进了安装包里，导致您完全看不到新界面。
    - **原因 2**: 懒人听书的接口存在防爬虫机制，没有携带特定的 `Cookie` 和 `Referer` 时会拒绝返回有效数据。
    - **解决**: 已经修复了语法错误，并为您把所有的浏览器模拟请求头（包含您的设备 UA、通行证 Cookie 以及来源站点校验等）全部注入到了底层的网络请求框架中，现在可以完美突破反爬墙获取到每日推荐榜单啦！

## v1.0.8 (2026-02-20)
- **修复**: 修复了书库中“删除选中的X本书”弹窗在某些情况下会跟随页面滚动，并且没有遮盖住顶部状态栏的问题。现在该确认弹出的模态框会强制置顶锁定在系统最上层（`z-index: 99999`），并且锁死底层滚动（`touchAction: none`），提供沉浸式的操作防误触体验。

## v1.0.7 (2026-02-20)
- **新功能**: 在搜索页面中新增了**“热门推荐”**板块。当搜索框内容为空时，系统会自动静默调用原生 Capacitor 引擎抓取《懒人听书》官网最新的“每日推荐”排行榜，解析出当日的热门有声书并以华丽的原生列表UI在搜索页呈现（包括封面图、书名、简介等）。点击任意热门推荐的书籍名称，会自动填充搜索框，省去您手动打字的烦恼，发现好书更便捷！

## v1.0.6 (2026-02-20)
- **优化**: 移除了书库中原先使用系统自带风格的 `window.confirm` （因为在不同手机上弹出的原色白框会很丑），统一重构并启用了我们内置暗黑模式兼容、带有高斯模糊及微动画渲染的定制移出确认弹窗，整体 UI 调性更加精美统一。
- **功能**: 收听报表的统计曲线图重装升级为**“可交互式数据图表”！** 无论是在日、周还是月视图下，您现在可以直接点击任意的一个节点曲线，上面会立刻浮现出一个气泡特效，向您精准展示当天/当月的具体听书分钟数。
- **构建**: 更新版本号到 1.0.6，同时保存旧版本到版本归档夹。

## v1.0.5 (2026-02-20)
- **优化**: 缩减了首屏开屏动画的强制等待时间，将原先写死的 2000ms 最小开场白等待时间缩短到了 500ms（并把渐出动画从 500ms 加快并缩减到了 300ms）。启动时只要音频数据库加载完毕，便会自动快速进入主界面。
- **修复**: 修复了“播放收听时长”在后台播放时无法正常记录的问题。
    - **原因**: 之前负责记录收听时长的方法是由前端浏览器内核的 `setInterval` 定时器来执行的。但是当应用退到 Android 锁屏后台运行服务时，系统会为了省电而挂起 Webview 里的所有 Timer 计时器模块，导致后台即使播放了几小时，前端的统计依然停滞不前卡在之前那一刻。
    - **解决**: 废弃了不可靠的区间定时器，转而把“总时长计算器”直接挂载在了原生 ExoPlayer 毫秒级反馈的 `positionUpdate` 物理事件心跳频率上，并通过计算真实世界的时间戳差值精准地将差额上报到数据库中保存。
- **构建**: 编译更新了版本号。同步将打包好的 `1.0.5.apk` 存入到历史记录存档区。

## v1.0.4 (2026-02-20)
- **修复**: 正式将“后台播放容错挂载机制”的补丁（曾经存在于 1.0.1）重新合并进稳定版本分支，永久解决了被系统清理进程后无法继续播放的问题。
- **构建**: 更新版本号到 1.0.4，存档历史 APK。

## v1.0.3 (2026-02-20)
- **回滚**: 因测试需求，回滚了 1.0.1 版本中修复的“后台锁屏杀后台后 `play()` 逻辑失效”的补丁。
    - 移除了原生对负数 `Duration` 的拦截和清零机制。
    - 移除了前端 `play()` 调用前的播放器装载空置检测机制。
- **构建**: 编译后已将构建好的 `1.0.3.apk` 存档至 `D:\code\离线听书\history_version\1.0.3.apk`，并通过 ADB 安装到了连接的测试设备上以供抓虫复现。

## v1.0.2 (2026-02-20)
- **修复**: 修复了应用打开后会长时间白屏，以及主页上的图标变成乱码英文字母（如 "home auto_stories" 等）的问题。
    - **原因**: 之前应用内部的图标和字体依赖于外网的 Google Fonts CDN (`fonts.googleapis.com`)。因为本应用定位是离线听书，如果用户的网络环境（或者国内网络下）无法快速联通该 CDN 服务器，应用会在启动时阻塞渲染数秒才会超时放弃，并且最终因为拉取失败导致图标变成占位符文本显示。
    - **解决**: 将所有的外网 CDN 剔除，全部转化为基于 npm 的本地内嵌依赖包 (`material-symbols` 和 `material-icons`) 直接打包进 App 内部。现在无论设备是否有网，应用都能实现毫秒级秒开和正确的图标呈现！

## v1.0.1 (2026-02-20)
- **修复**: 修复了应用长期处于后台后，再解锁手机或者切换回应用时，播放按钮点击无效的问题。
    - 添加了针对 ExoPlayer 退到后台可能因状态清空导致 `duration` 返回极其负的异常值的兼容修复，强制将其转换为 0。
    - 强化了 TS 层的保护恢复策略，保证底层崩溃或闲置情况下执行 `play()` 能够通过隐式拉取和加载播放列表自行恢复。
- **构建**: 更新了版本号。
